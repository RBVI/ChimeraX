<html>

<!--
=== UCSF ChimeraX Copyright ===
Copyright 2016 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  For details see:
http://www.rbvi.ucsf.edu/chimerax/docs/licensing.html
This notice must be embedded in or attached to all copies,
including partial copies, of the software or any revisions
or derivations thereof.
=== UCSF ChimeraX Copyright ===
-->

<head>
<link rel="stylesheet" type="text/css" href="../userdocs.css" />
<title>Command: device, vr</title>
</head><body>

<a name="top"></a>
<a href="../index.html">
<img width="60px" src="../ChimeraX-docs-icon.svg" alt="ChimeraX docs icon"
class="clRight" title="User Guide Index"/></a>

<h3><a href="../index.html#commands">Command</a>: device, vr</h3>

<h3 class="usage"><a href="usageconventions.html">Usage</a>:
<br><b>device</b> &nbsp;<i>device-type</i> [&nbsp;<i>status</i>&nbsp;] 
&nbsp;<i>device-options</i>
</h3>
<p>
The <b>device</b> command sets modes for certain external devices, 
where the <i>device-type</i> can be:
</p>
<ul>
<li><a href="#snav"><b>snav</b></a> 
&ndash; SpaceNavigator<sup>&reg;</sup> 3D mouse
<li><a href="#webcam"><b>webcam</b></a>
&ndash; use webcam video as the background for augmented reality
<li><a href="#vr"><b>vr</b></a>
&ndash; HTC Vive, Oculus Rift, Samsung Odyssey virtual reality systems
  <ul>
  <li><a href="#vr-button"><b>vr button</b></a> 
  &ndash; assign functions to hand-controller buttons
  <li><a href="#vr-roomCamera"><b>vr roomCamera</b></a>
  &ndash; set up a separate camera view fixed in the VR room coordinates,
  useful for making videos
  </ul>
<li><a href="#realsense"><b>realsense</b></a>
&ndash; requires installing the
<a href="https://cxtoolshed.rbvi.ucsf.edu/apps/chimeraxrealsense"
target="_blank"><b>RealSense</b> bundle</a> from the
<a href="https://cxtoolshed.rbvi.ucsf.edu/"
target="_blank">ChimeraX Toolshed</a> (menu: <b>Tools... More Tools...</b>);
allows blending video from a Intel RealSense depth-sensing camera 
with ChimeraX graphics for 3D augmented reality with depth from both inputs
<li><a href="#leapmotion"><b>leapmotion</b></a>
&ndash; requires installing the
<a href="https://cxtoolshed.rbvi.ucsf.edu/apps/chimeraxleapmotion"
target="_blank"><b>LeapMotion</b> bundle</a> from the
<a href="https://cxtoolshed.rbvi.ucsf.edu/"
target="_blank">ChimeraX Toolshed</a> (menu: <b>Tools... More Tools...</b>);
allows using a <a href="https://en.wikipedia.org/wiki/Leap_Motion"
target="_blank">Leap Motion</a> hand-tracking device (Windows only)
<li><a href="#lookingglass"><b>lookingglass</b></a>
&ndash; use a <a href="https://lookingglassfactory.com/product"
target="_blank">Looking Glass</a> holographic display
</ul>
<p>
See also:
<a href="../movies.html">making movies</a>,
<a href="https://www.rbvi.ucsf.edu/chimerax/data/sbgrid-july2020/"
target="_blank">Augmented reality videos with ChimeraX</a>,
<a href="https://www.rbvi.ucsf.edu/chimerax/data/mixed-reality-nov2019/mrhowto.html" 
target="_blank">Mixed reality video recording in ChimeraX</a>
</p><p>
<a name="status"></a>
The <i>status</i> of a mode can be 
<b>on</b> (synonyms <b>true</b>, <b>True</b>, <b>1</b>)
or <b>off</b> (synonyms <b>false</b>, <b>False</b>, <b>0</b>).
Device-specific options are described below.
</p>

<a href="#top" class="nounder">&bull;</a>
<a name="snav"><b>device snav</b></a>
[&nbsp;<a href="#status"><i>status</i></a>&nbsp;]
[&nbsp;<b>fly</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
[&nbsp;<b>speed</b>&nbsp;&nbsp;<i>factor</i>&nbsp;]
<blockquote>
<p>
The command <b>device snav</b> enables manipulation 
with a SpaceNavigator<sup>&reg;</sup> 3D mouse from
<a href="https://www.3dconnexion.com/" target="_blank">3Dconnexion</a>.
The <b>fly</b> option indicates whether the force applied to the device 
should be interpreted as acting on the camera (<b>true</b>), where
pushing forward zooms in because it moves the camera viewpoint toward the scene,
or as acting on the models in the scene (<b>false</b>, default), where
pushing forward zooms out because it pushes the models away.
In either case, however, it is the camera that actually moves.
The <b>speed</b> option sets a sensitivity <i>factor</i> for motion
relative to the device (default <b>1.0</b>).
Decreasing the value (for example, to 0.1) reduces sensitivity to give
slower motion, whereas increasing the value has the opposite effect.
See also: <a href="ui.html#mousemode"><b>mousemode</b></a>
</p>
</blockquote>

<a href="#top" class="nounder">&bull;</a>
<a name="webcam"><b>webcam</b></a>
[&nbsp;<a href="#status"><i>status</i></a>&nbsp;]
[&nbsp;<b>foregroundColor</b>&nbsp;&nbsp;<a href="colornames.html"><i>color-spec</i></a>&nbsp;]
[&nbsp;<b>saturation</b>&nbsp;&nbsp;<i>N</i></a>&nbsp;]
[&nbsp;<b>colorPopup</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
[&nbsp;<b>flipHorizontal</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>framerate</b>&nbsp;&nbsp;<i>fps</i>&nbsp;]
[&nbsp;<b>size</b>&nbsp;&nbsp;<i>xpixels,ypixels</i>&nbsp;]
[&nbsp;<b>name</b>&nbsp;&nbsp;<i>camera-name</i></a>&nbsp;]
<blockquote>
The <b>webcam</b> command (same as <b>device webcam</b>)
shows webcam video as a flat background behind the ChimeraX scene,
except that items similar to the specified foreground color
(default <b>lime green</b>
<table border cellpadding="4" cellspacing="0"
style="display:inline-block; vertical-align:middle"><tr>
<td bgcolor="limegreen" width="10px" title="lime green"></td></tr></table>)
will appear in front.
This allows pointing with a real item to features in the ChimeraX scene.
The <b>saturation</b> option sets the stringency of color-matching
(default <b>5</b>, details below) and the <b>colorPopup</b> option (default
<b>false</b>) sets whether pausing the cursor over the background shows
a popup balloon reporting the color of the underlying pixel 
as R,G,B color components on the 0-100 scale.
</p><p>
The <b>flipHorizontal</b> option (default <b>true</b>)
shows the left-right mirror image of the webcam video so that pointing
rightward while facing the webcam and screen is shown as 
pointing rightward in the video.
</p><p>
If <b>size</b> is not specified,
the video resolution is whatever the webcam can provide given the target
<b>framerate</b> value (default <b>25</b> frames per second), or if
that rate is not possible, the closest framerate supported by the camera.
If <b>size</b> is specified, the closest size supported by the camera
is provided, and matching the framerate is given second priority.
</p><p>
The <b>name</b> option allows using a specific webcam when more than one
is available. The <b>webcam</b> command reports 
in the <a href="../tools/log.html"><b>Log</b></a> the names
of the available webcams and which one it is using.
If it is not using the desired one, <a href="close.html">close</a> the 
existing webcam model and reissue the <b>webcam</b> command with the
<b>name</b> option, enclosing the full <i>camera-name</i> in quotation marks,
for example:
</p>
<blockquote>
<b>webcam name "FaceTime HD Camera (Built-in)"</b>
</blockquote>
<p>
When the command is issued, any unspecified options are set to their defaults.
An exception is that
to change the framerate and size after a previous <b>webcam</b> command,
it is necessary to use <b>webcam off</b> first and then <b>webcam on</b>
with the new values.
</p><p>
Note that other applications in use at the same time as ChimeraX
may change the webcam resolution or framerate unexpectedly.
Not all webcams will work with this command, only ones that use certain
RGB and YUV pixel formats. If an unsupported pixel format is used,
an error message will appear and the video will not be 
shown in the ChimeraX background. 
</p><p>
<b>Color-matching details</b>: only the relative intensities of the
R,G,B components of the foreground color are important.
Pixels in the webcam view are considered as matching if the intensity
order of the R,G,B components matches that of the foreground color
(for example, G>B>R) and these components are separated by at least the 
<b>saturation</b> value on the 0-100 scale. With the default parameters,
for example (<b>foregroundColor</b> G>B=R and <b>saturation</b> 5), 
any pixels with the green component at least 5 greater than both the 
red and blue components (on the 1-100 scale)
will be shown in front of the ChimeraX scene.
</p>
</blockquote>

<a href="#top" class="nounder">&bull;</a>
<a name="vr"><b>vr</b></a> [&nbsp;<a href="#status"><i>status</i></a>&nbsp;]
[&nbsp;<b>mirror</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>center</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>clickRange</b>&nbsp;&nbsp;<i>r</i>&nbsp;]
[&nbsp;<b>gui</b>&nbsp;&nbsp;<i>tool1</i>[<i>,tool2</i>&nbsp;...&nbsp;]]
[&nbsp;<b>simplifyGraphics</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>multishadowAllowed</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
[&nbsp;<b>nearClipDistance</b>&nbsp;&nbsp;<i>d<sub>n</sub></i>&nbsp;]
[&nbsp;<b>farClipDistance</b>&nbsp;&nbsp;<i>d<sub>f</sub></i>&nbsp;]
[&nbsp;<b>roomPosition</b>&nbsp;&nbsp;<i>matrix</i>&nbsp;|&nbsp;<b>report</b>&nbsp;]
<blockquote>
<p>
The <b>vr</b> command (same as <b>device vr</b>)
enables a virtual reality mode for systems supported by
<a href="https://store.steampowered.com/about/"
target="_blank">SteamVR</a>, including HTC Vive, Oculus Rift,
and Samsung Odyssey. SteamVR must be installed separately by the user
and started before the mode is enabled.
In addition, Oculus Rift users should start the Oculus runtime 
before starting SteamVR. For details and related issues, 
see <a href="../vr.html">ChimeraX virtual reality</a>.
See also: 
<a href="#vr-button"><b>vr button</b></a>,
<a href="#vr-roomCamera"><b>vr roomCamera</b></a>,
<a href="meeting.html"><b>meeting</b></a>,
<a href="buttonpanel.html"><b>buttonpanel</b></a>,
<a href="camera.html"><b>camera</b></a>,
<a href="view.html"><b>view</b></a>,
<a href="../movies.html">making movies</a>
<p>
VR status, model positions in the room, and hand-controller
<a href="#vr-button">button assignments</a> are saved in
<a href="save.html#session">ChimeraX session files</a>.
The VR model positions and button assignments
are also retained through uses of <b>vr on</b> and <b>vr off</b>,
but not after exiting ChimeraX.
</p><p>
The <b>mirror</b> option indicates whether to show the ChimeraX scene
in the desktop graphics window. If true (default), 
the VR headset right-eye view is shown,
with <a href="graphics.html#waitForVsync"><b>graphics waitForVsync</b></a>
automatically set to false so that VR rendering will not slow down
to the desktop rendering rate.
If false, no graphics are shown in the desktop display, allowing 
all graphics computing resources to be dedicated to VR headset rendering.
Updating the graphics window can cause flicker in the VR headset
because refreshing the computer display (nominally 60 times per second)
slows rendering to headset. ChimeraX turns off syncing to
vertical refresh if possible. Another way to mirror is to use
SteamVR's menu entry to display mirror window.
</p><p>
The <b>center</b> option (default <b>true</b>)
centers and scales models in the room.
<p><p>
The <b>clickRange</b> option sets the depth range for
picking objects with the hand-controller cones, where <i>r</i>
(default <b>5.0</b>) is the maximum distance from the tip of the cone 
to the object in scene distance units, typically &Aring;.
Limiting the range prevents accidentally picking far-away objects.
</p><p>
<a name="vrgui"></a>
The <b>gui</b> option specifies which ChimeraX tool panels to show in VR
when the hand-controller button assigned to that function 
(by <a href="../vr.html#default-controller">default</a>,
Vive <b><i>menu</i></b> or Oculus B/Y) is pressed.
Any combination of tools can be specified as
a comma-separated list of one or more tool names,
as listed in the <b>Tools</b> menu and shown for most tools in 
their title bars. Tools may also be custom panels created with the
<a href="buttonpanel.html"><b>buttonpanel</b></a> command.
If the <b>gui</b> option is not given,
the same tools as currently shown in the desktop display
(including the <a href="../tools/toolbar.html"><b>Toolbar</b></a>,
and on Windows only, the ChimeraX <a href="../menu.html">main menu</a>)
will be shown. 
</p><p>
The <b>simplifyGraphics</b> option (default <b>true</b>)
reduces the maximum level of detail in VR by limiting the 
total atom and bond triangles to one million each.
This helps to maintain full rendering speed. The previous total-triangle 
limits are restored when the VR mode is turned off. Normally,
the maximum atom and bond triangles are set to five million each.
See also: <a href="graphics.html"><b>graphics</b></a>
</p><p>
Ambient shadowing or &ldquo;ambient occlusion&rdquo;
requires calculating shadows from multiple directions.
This may make rendering too slow for VR and cause stuttering in the headset,
especially if the number of directions (the
<a href="lighting.html#multiShadow"><b>lighting multiShadow</b></a> 
parameter) is high.
By default (<b>multishadowAllowed</b> &nbsp;<b>false</b>),
when the number of directions is &gt; 0, enabling VR switches to the
<a href="lighting.html#preset"><b>simple</b></a> lighting preset, which
does not use ambient shadowing.
With <b>multishadowAllowed</b> &nbsp;<b>true</b>, 
enabling VR does not automatically change the lighting.
In VR, the lighting presets with ambient shadowing
(<a href="lighting.html#preset"><b>full</b></a>,
<a href="lighting.html#preset"><b>soft</b></a>, and
<a href="lighting.html#preset"><b>gentle</b></a>)
use 8 directions instead of 64.
</p><p>
The <b>nearClipDistance</b> and <b>farClipDistance</b> options
set clipping-plane positions in meters from the viewer
(defaults <i>d<sub>n</sub></i> = <b>0.1</b> and
<i>d<sub>f</sub></i> =  <b>500</b>). The difference from using the
<a href="clip.html"><b>clip</b></a> command is that these options
keep the planes at the specified distances from the viewer as the viewpoint
changes.
If surfaces are clipped, for speed-of-interaction purposes it may be useful
to hide the planar caps 
(command <b><a href="surface.html#cap">surface cap false</a></b>).
</p><p>
When the mode is enabled, the <b>roomPosition</b> option can be used to
specify the transformation between room coordinates (in meters, 
with origin at room center) and scene coordinates (typically in &Aring;)
or to simply <b>report</b> the current transformation
in the <a href="../tools/log.html"><b>Log</b></a>.
The transformation <i>matrix</i> is given as
12 numbers separated by commas only, corresponding to a 3x3 matrix 
for rotation and scaling, with a translation vector in the fourth column.
Ordering is row-by-row, such that the translation vector is given as 
the fourth, eighth, and twelfth numbers. Example:
</p>
<blockquote>
<b>vr &nbsp;room &nbsp;20,0,0,0,0,20,0,0,0,0,20,0</b>
</blockquote>
<p>
The frequency of <a href="label.html#orient">label reoriention</a>
is automatically decreased when VR is enabled and 
restored when VR is turned off.
</p>
</blockquote>

<a href="#top" class="nounder">&bull;</a>
<a name="vr-button"><b>vr button</b></a> 
&nbsp;<i>button-name</i>
[&nbsp;<i>function</i>&nbsp;]
[&nbsp;<b>command</b>&nbsp;&nbsp;"<i>string</i>"&nbsp;]
[&nbsp;<b>hand</b>&nbsp;&nbsp;left&nbsp;|&nbsp;right&nbsp;]
<blockquote>
<table class="clRight" cellspacing="0">
<tr><td>
<a href="../tutorials/dicom-vr3.png">
<img class="outline" src="../tutorials/dicom-vr3.png" title="click to enlarge..."
alt="Vive hand controllers" width="300px"></a>
</td></tr>
<tr><td align="center"><font size="-1">
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">Vive</a> hand controllers
</font></td></tr>
<tr><td>
<a href="../tutorials/oculus-touch.png">
<img class="outline" src="../tutorials/oculus-touch.png"
title="click to enlarge..."
alt="Oculus hand controllers" width="300px"></a>
</td></tr>
<tr><td align="center"><font size="-1"><a href="https://www.oculus.com/"
target="_blank">Oculus</a> &ldquo;Touch&rdquo; hand controllers
</font></td></tr>
</table>
<p>
The <b>vr button</b> command assigns modes (functions) to 
the hand-controller buttons in <a href="../vr.html">virtual reality</a>,
as a scriptable alternative to <a href="../vr.html#mousemodes">clicking icons
to assign modes interactively</a>.
The available <i>function</i> names are as listed 
<a href="ui.html#functions">above</a> for 
<a href="ui.html#mousemode"><b>mousemode</b></a>,
plus the following VR-specific modes:
</p>
<ul>
<li><b>recenter</b> &ndash; center and scale models in the room
<li><b>show ui</b> &ndash; collectively show, hide, move ChimeraX tool panels
</ul>
<p>
Alternatively, with the <b>command</b> option,
<a href="../index.html#commands">command(s)</a> to execute upon button click 
can be given as a <i>string</i> enclosed in quotation marks.
The string may contain multiple commands with semicolon separators.
</p><p>
The available <i>function</i> names can be listed in the
<a href="../tools/log.html"><b>Log</b></a> with
command <a href="usage.html"><b>usage</b></a> <b>vr button</b>,
and should be enclosed in quotation marks if they contain spaces.
The function can also be given as the word <b>default</b> to reset to
<a href="../vr.html#default-controller">default functions</a>.
</p><p>
If no <i>function</i> or <b>command</b> assignment is given, the current 
function is reported in the <a href="../tools/log.html"><b>Log</b></a>.
</p><p>
The <b>hand</b> option can be given to assign a function 
to the specified button of only one hand controller; 
otherwise, those on both controllers will be assigned.
</p><p>
The <i>button-name</i> can be:
</p>
<ul>
<li><b>trigger</b>
<li><b>grip</b>
<li><b>touchpad</b> (synonym <b>thumbstick</b>)
&ndash; Vive trackpad or Oculus thumbstick
<li><b>menu</b> 
&ndash; Vive menu button
<li><b>A</b> 
&ndash; a button on the Oculus right hand controller
(<b>hand</b> option ignored)
<li><b>B</b>
&ndash; a button on the Oculus right hand controller
(<b>hand</b> option ignored; same as <b>menu</b> with <b>hand right</b>)
<li><b>X</b>
&ndash; a button on the Oculus left hand controller
(<b>hand</b> option ignored)
<li><b>Y</b>
&ndash; a button on the Oculus left hand controller
(<b>hand</b> option ignored; same as <b>menu</b> with <b>hand left</b>)
<li><b>all</b>
&ndash; all hand-controller buttons, primarily for use in the command:
<b>vr button all default</b>
</ul>
<p>
Initial defaults are to <b>translate</b> and <b>rotate</b> with triggers,
<b>zoom</b> with Vive touchpad or Oculus A button,
<b>recenter</b> with Vive grip or Oculus X button,
and <b>show ui</b> with the Vive menu or Oculus B/Y button
(<a href="../vr.html#default-controller">more...</a>).
</p><p>
The only <a href="ui.html#functions"><i>function</i></a> settings that work
by tilting the Oculus <b><i>thumbstick</i></b> are <b>rotate</b>
<a href="ui.html#functions">
<img class="icon" border=1 src="../tools/mouse-icons/rotate.png"></a>,
<b>zoom</b> <a href="ui.html#functions">
<img class="icon" border=1 src="../tools/mouse-icons/zoom.png"></a>,
<b>contour level</b>
<a href="ui.html#functions">
<img class="icon" border=1 src="../tools/mouse-icons/contour.png"></a>,
<b>play map series</b>
<a href="ui.html#functions">
<img class="icon" border=1 src="../tools/mouse-icons/vseries.png"></a>,
and <b>play coordinates</b>
<a href="ui.html#functions">
<img class="icon" border=1 src="../tools/mouse-icons/coordset.png"></a>.
</p>
</blockquote>

<a href="#top" class="nounder">&bull;</a>
<a name="vr-roomCamera"><b>vr roomCamera</b></a> 
[&nbsp;<a href="#status"><i>status</i></a>&nbsp;]
[&nbsp;<b>fieldOfView</b>&nbsp;&nbsp;<i>angle</i>&nbsp;]
[&nbsp;<b>width</b>&nbsp;&nbsp;<i>w</i>&nbsp;]
[&nbsp;<b>backgroundColor</b>&nbsp;&nbsp;<a href="colornames.html"><i>color-spec</i></a>&nbsp;]
[&nbsp;<b>savePosition</b>&nbsp;&nbsp;true&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>showHands</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;|&nbsp;toggle&nbsp;]
[&nbsp;<b>showPanels</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;|&nbsp;toggle&nbsp;]
[&nbsp;<b>tracker</b>&nbsp;&nbsp;true&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>saveTrackerMount</b>&nbsp;&nbsp;true&nbsp;|&nbsp;false&nbsp;]
<blockquote>
The <b>vr roomCamera</b> command sets up a separate camera view fixed 
in the VR room coordinates, useful for making video tutorials.
The camera view is shown in the desktop graphics window 
and as &ldquo;picture in picture&rdquo; in the VR headset. 
See also: <a href="camera.html"><b>camera</b></a>,
<a href="../movies.html">making movies</a>
<p>
The <b>vr roomCamera</b> command can only be used in 
<a href="../vr.html">virtual reality</a>
(after using <a href="#vr"><b>vr on</b></a>).
In VR, the room camera is shown as a rectangle at the camera position 
(initially with its center 1.5 meters above the floor and offset 2 meters 
horizontally from the room center), facing the user and showing 
what the camera sees.
The <b>width</b> of the rectangle is given in meters (default <b>1.0</b>),
and the height is chosen to match the aspect ratio of the desktop graphics
window. The default <b>fieldOfView</b> for the room camera is <b>90</b>&deg;.
The background color of the room camera can be set separately from the VR
background; default is a dark gray (<b>10,10,10</b>)
so that the rectangle is visible against a black scene background.
</p><p>
The room camera rectangle
is a model that can be <a href="../selection.html">selected</a>
and then moved in VR with the
<a href="../vr.html#mousemodes">hand-controller mode</a>
assigned by clicking either icon:
<a href="../tools/mousemodes.html" title="Mouse Modes for Right Button...">
<img class="icon" src="../tools/mouse-icons/move_h2o.png" border="1"></a>
<a href="../tools/mousemodes.html" title="Mouse Modes for Right Button...">
<img class="icon" src="../tools/mouse-icons/rotate_h2o.png" border="1"></a>
(or with the <a href="#vr-button"><b>vr button</b></a> command).
</p><p>
Specifying <b>savePosition true</b> saves the current position and orientation
of the room camera in the <a href="../preferences.html#other">preferences</a>.
</p><p>
The <b>showHands</b> and <b>showPanels</b> options control whether the
hand-controller cones and <a href="#vrgui">VR gui panels</a> are shown 
in the room camera view, respectively (default <b>true</b>, whereas 
<b>toggle</b> reverses the current setting). 
These options do not affect what is shown in the headset.
</p><p>
Two options allow using a 
<a href="https://www.vive.com/us/vive-tracker/" target="_blank">Vive Tracker</a>
device to control the room camera position:
</p>
<ul>
<li>Using <b>tracker true</b> synchronizes the room camera to the
position and orientation of the device, with offsets
(if any) previously saved with <b>saveTrackerMount true</b>.
<li>Using <b>saveTrackerMount true</b> saves in the
<a href="../preferences.html#other">preferences</a>
the current room camera translation and rotation relative to the device.
</ul>
<p>
Thus, the room camera can be moved by hand as described above,
and then its offsets from the device (for when <b>tracker true</b> is used) 
in position and orientation saved with <b>saveTrackerMount true</b>.
</p>
</blockquote>

<a href="#top" class="nounder">&bull;</a>
<a name="realsense"><b>realsense</b></a> 
[&nbsp;<a href="#status"><i>status</i></a>&nbsp;]
[&nbsp;<b>size</b>&nbsp;&nbsp;<i>x,y</i>&nbsp;]
[&nbsp;<b>dsize</b>&nbsp;&nbsp;<i>dx,dy</i>&nbsp;]
[&nbsp;<b>framesPerSecond</b>&nbsp;&nbsp;<i>fps</i>&nbsp;]
[&nbsp;<b>align</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>denoise</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>denoiseWeight</b>&nbsp;&nbsp;<i>weight</i>&nbsp;]
[&nbsp;<b>denoiseColorTolerance</b>&nbsp;&nbsp;<i>tolerance</i>&nbsp;]
[&nbsp;<b>denoise</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
[&nbsp;<b>projector</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
[&nbsp;<b>angstromsPerMeter</b>&nbsp;&nbsp;<i>apm</i>&nbsp;]
[&nbsp;<b>skipFrames</b>&nbsp;&nbsp;<i>N</i>&nbsp;]
[&nbsp;<b>setWindowSize</b>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
<blockquote>
The command <b>realsense</b> (same as <b>device realsense</b>) 
enables blending video from an Intel RealSense depth-sensing camera 
with ChimeraX graphics to make augmented reality videos. 
If <a href="#vr">VR</a> is enabled, this command automatically starts a 
<a href="#vr-roomCamera">virtual-reality room camera</a>
which renders the models to be blended with the RealSense camera image.
It also sets the graphics window size to match the RealSense camera image size.
This command is only available after installation of the
<a href="https://cxtoolshed.rbvi.ucsf.edu/apps/chimeraxrealsense"
target="_blank"><b>RealSense</b> bundle</a> from the
<a href="https://cxtoolshed.rbvi.ucsf.edu/"
target="_blank">ChimeraX Toolshed</a> (menu: <b>Tools... More Tools...</b>).
</p><p>
The <b>size</b> and <b>dsize</b> options set camera image resolution
for color and depth, respectively. Each takes a pair of comma-separated values
indicating the pixel dimensions in X and Y (defaults: <b>size 960,540</b> and
<b>dsize 1280,720</b>). The <b>framesPerSecond</b> option gives the video
capture rate (default <b>30</b>). The <b>align</b> option indicates whether
to compensate the offset between the color and depth cameras in the device
(default <b>true</b>, which slows rendering). 
The <b>denoise</b> option (default <b>true</b>)
specifies whether to depth-denoise by averaging depth over time at pixels
when their colors remain fairly constant using parameters
<b>denoiseWeight</b> (default <b>0.1</b>) and <b>denoiseColorTolerance</b>
(default <b>10</b>). Denoising details are given below.
The <b>projector</b> option enables spraying the room with IR dots
from a projector on the camera device for better depth detection (default 
<b>false</b>, as the IR beams interfere with other devices that use IR
such as Vive VR tracking). Normally the camera device is used at the
same time as <a href="#vr">VR</a>, which in turn sets the scale factor
of the scene relative to the room.  However, if <a href="#vr">VR</a> is not
in use, the <b>angstromsPerMeter</b> option can be used to specify the
relative scale (default <b>50</b>).
The <b>skipFrames</b> option indicates how many ChimeraX graphics update frames
to skip before getting a new camera frame (default <b>2</b>, meaning to get
a new camera frame at every 3rd ChimeraX graphics frame).
The <b>setWindowSize</b> option causes the graphics window size to be changed
to match the camera color image resolution (default <b>true</b>).
</p><p>
<b>Denoising details:</b>
The depth values from RealSense cameras fluctuate rapidly over time by 
small amounts, and the depth value for some pixels is unknown.
This depth noise causes flickering in the blended video where depths 
are fluctuating or unknown, especially at boundaries
between video objects and computer-generated objects.
The <b>denoise true</b> option reduces the depth noise by averaging 
depth over time at pixels when their colors remain fairly constant. 
When the color of a pixel changes by more than 10 on a RGBA scale of 255,
its depth is always updated immediately to reduce motion blur.
The averaging blends current depth values with the previously 
used depth with weight 0.1, so it roughly averages depth from the 
previous 10 frames. Pixels with unknown depth occur for two reasons.
In some areas of the video frame such as blank white walls the camera is
unable to judge depth because it relies on matching features in the 
two stereo IR cameras, and if there are no discernible features to match,
the depth is reported as 0. This problem can be reduced by using 
<b>projector true</b>, which projects a dense array of invisible 
infrared laser dots in the room to add texture (but can 
interfere with tracking by VR headsets that also use infrared).
The second cause of missing depth values is that only one stereo camera sees a
part of the room because the other stereo camera is blocked by an object.
This happens at boundaries of foreground objects in the room.
To minimize both of these effects (but especially the second), 
the denoise option keeps track of the maximum depth seen at each pixel 
and its color, representing the room background. If a depth value is not 
available for a pixel for a frame, it will use the maximum depth value,
provided that the color of the pixel is close to the color of the background.
This background depth fill does not help for pixels for which the 
camera has never reported a depth value. The denoising algorithm 
is based on the assumption that the camera is not moving.
</blockquote>

<a href="#top" class="nounder">&bull;</a>
<a name="leapmotion"><b>leapmotion</b></a> 
[&nbsp;<a href="#status"><i>status</i></a>&nbsp;]
[&nbsp;<b>headMounted</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
[&nbsp;<b>pointerSize</b>&nbsp;&nbsp;<i>size</i>&nbsp;]
[&nbsp;<b>pinchThresholds</b>&nbsp;&nbsp;<i>pinch,unpinch</i>&nbsp;]
[&nbsp;<b>modeLeft</b>&nbsp;&nbsp;mouse&nbsp;|&nbsp;<b>vr</b>&nbsp;]
[&nbsp;<b>modeRight</b>&nbsp;&nbsp;mouse&nbsp;|&nbsp;<b>vr</b>&nbsp;]
[&nbsp;<b>width</b>&nbsp;&nbsp;<i>width</i>&nbsp;]
[&nbsp;<b>maxDelay</b>&nbsp;&nbsp;<i>delay</i>&nbsp;]
[&nbsp;<b>center</b>&nbsp;&nbsp;<i>x,y,z</i>&nbsp;]
[&nbsp;<b>facing</b>&nbsp;&nbsp;<i>x,y,z</i>&nbsp;]
[&nbsp;<b>cord</b>&nbsp;&nbsp;<i>x,y,z</i>&nbsp;]
[&nbsp;<b>debug</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
<blockquote>
The command <b>leapmotion</b> (same as <b>device leapmotion</b>) 
enables using a <a href="https://en.wikipedia.org/wiki/Leap_Motion"
target="_blank">Leap Motion</a> hand-tracking device with ChimeraX
on Windows (<a href="https://www.rbvi.ucsf.edu/chimerax/data/leap-july2020/"
target="_blank">details...</a>). 
The command is only available after installation of the Windows
<a href="https://cxtoolshed.rbvi.ucsf.edu/apps/chimeraxleapmotion"
target="_blank"><b>LeapMotion</b> bundle</a>
from the <a href="https://cxtoolshed.rbvi.ucsf.edu/"
target="_blank">ChimeraX Toolshed</a> (menu: <b>Tools... More Tools...</b>).
<p>
The Leap Motion device contains cameras that track hand and finger positions. 
It can be placed on the desktop below the hands, or attached to a headset 
facing the screen (specified with <b>headMounted true</b>).
The head-mounted position works best. When in view of the device,
each hand is represented in the graphics window
by a pointer displayed as 3D crosshairs,
yellow crosshairs for the left and green for the right.
The <b>pointerSize</b> option sets pointer diameter
(the length of each crosshair), with default <b>1.0</b> &Aring;.
In ChimeraX, the pointers are models named 
<b>left hand</b> and <b>right hand</b>
under a top-level model named <b>Leap Motion</b>.
</p><p>
Pinching the thumb to the index finger is equivalent to a button click.
The left hand acts as the left mouse button and the right hand as 
the right mouse button (see <a href="ui.html#mousemode"><b>mousemode</b></a>;
initial default assignments are rotate and translate, respectively).
For button assignments that involve clicking specific objects,
picking is along the line of sight from the pointer position.
The mode of cursor tracking for each hand can be <b>mouse</b>
(in the 2D plane of the screen) or <b>vr</b> (default,
in 3D including hand orientation).
The <b>pinchThresholds</b> are pinch detection sensitivities in the range 
0-1.0, with defaults <b>0.9</b> for pinching and <b>0.6</b> for unpinching.
</p><p>
The <b>width</b> option gives the hand-motion range in millimeters
(default <b>250</b>) corresponding to the full width of the graphics window.
The <b>maxDelay</b> value (default <b>0.2</b> seconds) prevents using
older previous hand positions when ChimeraX is responding slowly.
</p><p>
Device position can be specified with the <b>center</b>, 
<b>facing</b>, and <b>cord</b> options. Each of these options takes 
three floating-point values separated by commas only.
The <b>center</b> option gives the center of tracking space in millimeters
relative to the Leap device, with <i>x</i> along the device long axis
increasing away from the cord and <i>y</i> along the sensor-facing direction
(default <b>0,250,0</b>).
The <b>facing</b> option gives the direction the sensor is facing 
in <a href="view.html#screencoords">screen coordinates</a>
(default <b>0,0,&minus;1</b> if head-mounted, otherwise <b>0,1,0</b>). 
The <b>cord</b> option gives the direction in which the cord leaves the device 
in <a href="view.html#screencoords">screen coordinates</a>
(default <b>1,0,0</b> if head-mounted, toward the right, 
otherwise <b>&minus;1,0,0</b>, toward the left).
</p><p>
The <b>debug</b> option specifies whether to write LeapC library 
debugging messages (default <b>false</b>).
The messages are sent to stderr in the Windows console from which ChimeraX 
was started, not to the <a href="../tools/log.html"><b>Log</b></a>.
</p>
</blockquote>

<a href="#top" class="nounder">&bull;</a>
<a name="lookingglass"><b>lookingglass</b></a>
[&nbsp;<a href="#status"><i>status</i></a>&nbsp;]
[&nbsp;<b>viewAngle</b>&nbsp;&nbsp;<i>angle</i>&nbsp;]
[&nbsp;<b>fieldOfView</b>&nbsp;&nbsp;<i>fov</i>&nbsp;]
[&nbsp;<b>depthOffset</b>&nbsp;&nbsp;<i>offset</i>&nbsp;]
[&nbsp;<b>verbose</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
[&nbsp;<b>quilt</b>&nbsp;&nbsp;true&nbsp;|&nbsp;<b>false</b>&nbsp;]
[&nbsp;<b>deviceNumber</b>&nbsp;&nbsp;<i>N</i>&nbsp;]
<blockquote>
The command <b>lookingglass</b> (same as <b>device lookingglass</b>)
enables showing the contents of the ChimeraX graphics window in
a <a href="https://lookingglassfactory.com/product" 
target="_blank">Looking Glass</a> holographic display
(<a href="https://www.rbvi.ucsf.edu/chimerax/data/lookingglass-july2020/"
target="_blank">details...</a>).
This device uses 45 images spanned by the horizontal <b>viewAngle</b>
(default <b>40</b>&deg;). 
Each image is rendered with the specified <b>fieldOfView</b> 
(default <b>22</b>&deg; recommended by the device manufacturer).
</p><p>
The <b>depthOffset</b> (default <b>0.0</b> &Aring;)
is the position of the center of the bounding box of displayed models
relative to the mid-depth plane of the Looking Glass display, where
the focus is best.
Positive values push the models further back in the display.
Enabling a Looking Glass automatically assigns adjusting the depth offset
to <b>Shift-scroll</b> with the mouse or trackpad.
This <b>lookingglass depth</b> mode can be assigned to other buttons using
the <a href="ui.html#mousemode"><b>mousemode</b></a> command.
</p><p>
The <b>verbose</b> option (default <b>false</b>) 
gives technical device parameters in the
<a href="../tools/log.html"><b>Log</b></a>.
The <b>quilt</b> option (default <b>false</b>) shows the 45 images as
tiled in a separate window and is used for debugging.
The <b>deviceNumber</b> option (not yet working) designates a
specific Looking Glass device when more than one is connected.
See also:
<a href="camera.html"><b>camera</b></a>
</p>
</blockquote>
<hr>
<address>UCSF Resource for Biocomputing, Visualization, and Informatics / 
November 2020</address>
</body></html>
