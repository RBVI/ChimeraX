<html>

<!--
=== UCSF ChimeraX Copyright ===
Copyright 2016 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  For details see:
http://www.rbvi.ucsf.edu/chimerax/docs/licensing.html
This notice must be embedded in or attached to all copies,
including partial copies, of the software or any revisions
or derivations thereof.
=== UCSF ChimeraX Copyright ===
-->

<head>
<title>ChimeraX Virtual Reality</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="userdocs.css" />
</head><body>

<a name="top"></a>
<a href="index.html">
<img width="60px" src="ChimeraX-docs-icon.svg" alt="ChimeraX docs icon"
class="clRight" title="User Guide Index"/></a>

<h2>ChimeraX Virtual Reality</h2>

<table class="clRight">
<tr><td>
<a href="vive.jpg"><img class="outline" width="250px" src="vive.jpg" 
alt="using HTC Vive VR system" title="click to enlarge..."></a>
</td></tr>
</table>

<p>
ChimeraX allows display and analysis of structures and density maps 
using virtual reality headsets such as HTC Vive,
Vive Pro, Oculus Rift, Samsung Odyssey and Windows Mixed Reality.
For multi-person VR sessions, see the
<a href="commands/meeting.html"><b>meeting</b></a> command
and <a href="tools/meeting.html"><b>Meeting</b></a> tool.
To add buttons for easy command execution from within VR, see 
<a href="commands/buttonpanel.html"><b>buttonpanel</b></a>.
ChimeraX can also <a href="vrphone.html">record 360&deg; movies</a>.
</p>

<ul class="none">
<li><a href="#starting"><b>Starting VR Mode</b></a>
<li><a href="#mousemodes"><b>Hand-Controller Modes</b></a>
<li><a href="#displayicons"><b>Other Icons: Changing the Display, Etc.</b></a>
<li><a href="#interactive"><b>Limitations of Interactive Viewing</b></a>
</ul>

<p>
See also:
</p>
<blockquote>
<a href="https://www.sciencedirect.com/science/article/pii/S002228361830696X"
target="_blank">Molecular visualization on the holodeck.</a><br>
Goddard TD, Brilliant AA, Skillman TL, Vergenz S, Tyrwhitt-Drake J, Meng EC, Ferrin TE.<br>
<i>J Mol Biol.</i> 2018 Oct 19;430(21):3982-3996.
</blockquote>
<ul>
<li><a href="tutorials/dicom-vr.html">DICOM in VR tutorial</a>
<li><a href="../videos/index.html#vr" target="_blank">ChimeraX VR videos</a>
<li><a href="https://www.rbvi.ucsf.edu/chimerax/data/looksee-mar2023/looksee.html"
target="_blank">ChimeraX VR on standalone Quest headsets</a> and the
<a href="tools/sendtoquest.html"><b>Send to Quest</b></a> tool
<li>VR setup advice and observations:
[<a href="https://www.rbvi.ucsf.edu/chimera/data/laptop-vr-nov2018/laptopvr.html"
target="_blank">Windows</a>]
[<a href="https://www.rbvi.ucsf.edu/chimera/data/mac-vr-nov2018/mac-vr.html"
target="_blank">Mac</a>]
[<a href="https://www.rbvi.ucsf.edu/chimera/data/linux-vr-oct2018/linuxvr.html"
target="_blank">Linux</a>]
</ul>

<a name="starting"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Starting VR Mode</h3>

<table class="clRight" cellspacing="0">
<tr><td>
<a href="tutorials/dicom-vr3.png">
<img class="outline" src="tutorials/dicom-vr3.png" title="click to enlarge..."
alt="Vive hand controllers" width="300px"></a>
</td></tr>
<tr><td align="center"><font size="-1">
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html" target="_blank">Vive</a> hand controllers
</font></td></tr>
</table>
<p>
Any models displayed in ChimeraX can be shown in virtual reality headsets
supported by <a href="https://steamvr.com">SteamVR</a>, such as HTC Vive, 
Oculus Rift and Samsung Odyssey.
Most descriptions here are for Vive hand controllers, but other systems have 
hand-controller buttons that are generally similar in position and function.
</p><p>
Vive controllers each have a <b><i>trigger</i></b>
to &ldquo;pull&rdquo; with the index finger,
a <b><i>grip</i></b> button on the side,
and a larger round <b><i>trackpad</i></b> on the top surface
that can be pressed with the thumb.
Above the trackpad is a smaller <b><i>menu</i></b> button
marked with horizontal lines, and below it is a power button and
a green light indicating when the controller is turned on.
</p>

<table class="clRight" cellspacing="0">
<tr><td>
<a href="tutorials/dicom-vr2.png">
<img class="outline" src="tutorials/dicom-vr2.png" title="click to enlarge..."
alt="SteamVR status window" width="200px"></a>
</td></tr>
<tr><td align="center" width="200px"><font size="-1">
The <a href="https://steamvr.com" target="_blank">SteamVR</a> status window
shows icons for the goggles, two controllers, and two base stations
in green when they are detected as ready for use.
</font></td></tr>
</table>

<ol>
<li>start <a href="https://store.steampowered.com/about/" 
target="_blank">SteamVR</a> 
<li>start ChimeraX and open some data, for example, a PDB model:
<blockquote>
<b><a href="commands/open.html">open</a> 2gbp</b> 
</blockquote>
<li>enter the ChimeraX command: 
<blockquote>
<a href="commands/device.html#vr"><b>vr on</b></a>
</blockquote>
</ol>

<p>
Models in ChimeraX should then appear in the VR headset.
<a name="default-controller"></a>
The hand-controller positions are shown in the headset as cones,
and icons on the cones indicate button functions
or <a href="#mousemodes">modes</a>. Default assignments:
</p>

<table border cellpadding="4" cellspacing="0"><tr>
<td align="center" width="35%">rotate
<br><img src="tools/mouse-icons/rotate.png" class="icon3"></td>
<td class="text">&nbsp;rotate hand controller
with <b><i>trigger</i></b> pressed</td>
<td rowspan="5" align="center" valign="center" width="200px">
<a href="tutorials/dicom-vr6.png">
<img class="outline" src="tutorials/dicom-vr6.png" title="click to enlarge..."
alt="underside of cone" width="120px"></a>
<br><br><font size="-1">
The icon on the cone &ldquo;underside&rdquo; shows that the Vive
<b><i>trigger</i></b> is assigned to translation (and rotation),
and the icon on the side shows that the <b><i>grip</i></b> button
is assigned to center and rescale.
</font>
<br><br><a href="tutorials/oculus-cone2.png">
<img class="outline" src="tutorials/oculus-cone2.png" 
title="click to enlarge..." alt="cone for Oculus" width="50px"></a>
<br><br><font size="-1">
For Oculus (<i>vs.</i> Vive), the icons are arranged differently on the cones
to reflect the different physical positions of the buttons on the controllers.
</font>
</tr><tr>
<td align="center">translate in 3D
<br><img src="tools/mouse-icons/translate.png" class="icon3"></td>
<td>&nbsp;move hand controller with <b><i>trigger</i></b> pressed</td>
</tr><tr>
<td align="center">zoom
<br><img src="tools/mouse-icons/zoom.png" class="icon3"></td>
<td class="text">
&nbsp;move hand controllers farther apart or closer
together with both <b><i>triggers</i></b> pressed
<br>&nbsp;&nbsp;&ndash; or &ndash;<br>
&nbsp;move hand controller vertically with 
Vive <b><i>trackpad</i></b> pressed (Oculus A button)</td>
</tr><tr>
<td align="center">center and rescale
<br><img src="tools/shortcut-icons/viewall.png" class="icon2"></td>
<td class="text">&nbsp;Vive <b><i>grip</i></b> button (Oculus X button)</td>
</tr><tr>
<td align="center" class="text">
collectively show, hide, move tool panels
<br><br>
(a panel can be moved individually by
click-dragging with any button on its title bar, 
or on a blank area in the panel if no title bar)
</td>
<td class="text">
&nbsp;Vive <b><i>menu</i></b> button (Oculus B/Y button)</td>
</tr></table>
<p>
<table class="clRight" cellspacing="0">
<tr><td>
<a href="tutorials/oculus-touch.png">
<img class="outline" src="tutorials/oculus-touch.png"
title="click to enlarge..." alt="Oculus hand controllers" width="300px"></a>
</td></tr>
<tr><td align="center"><font size="-1"><a href="https://www.oculus.com/"
target="_blank">Oculus</a> &ldquo;Touch&rdquo; hand controllers
</font></td></tr>
</table>
The Oculus <b><i>grip</i></b> buttons have the same defaults as the
<b><i>triggers</i></b>. The Oculus <b><i>thumbstick</i></b> righthand
default is to zoom (forward and rightward tilts push models away),
and the lefthand default is to rotate models about the center of their
bounding box (left/right tilt to rotate around the vertical axis,
forward/backward tilt to rotate around the horizontal axis).
</p><p>
Showing ChimeraX tool panels including the 
<a href="tools/toolbar.html"><b>Toolbar</b></a> with the <b><i>menu</i></b>
(or B/Y) button allows
&ldquo;clicking&rdquo; icons to <a href="#displayicons">adjust the display</a> 
and <a href="#mousemodes">reassign button functions</a>.
In Windows only, the ChimeraX <a href="menu.html">main menu</a> is among
the tool panels shown.
</p><p>
The physical room bounds are shown
with blue squares when the headset or a hand controller 
comes close to a physical wall (within about a meter).
Models can be scaled to sizes larger than the physical room.
</p><p>
To turn off rendering in the VR headset and re-enable rendering on the 
desktop display, use the ChimeraX command:
</p>
<blockquote>
<a href="commands/device.html#vr"><b>vr off</b></a>
</blockquote>
<p>
VR status, model positions in the room, and hand-controller
<a href="commands/device.html#vr-button">button assignments</a> are saved in
<a href="commands/save.html#session">ChimeraX session files</a>.
The VR model positions and button assignments
are also retained through uses of <b>vr on</b> and <b>vr off</b>,
but not after exiting ChimeraX.
</p>

<a name="mousemodes"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Hand-Controller Modes</h3>
<p>
Most of the ChimeraX &ldquo;mouse&rdquo; modes
(function assignments) can be used with the VR hand controllers.
Functions are described in more detail in the
<a href="commands/ui.html#mousemode">mouse mode</a> documentation, but include:
</p>
<ul>
  <li><a href="selection.html">select</a>
  <li>rotate + translate (single mode in VR)
   &ndash; default/recommended for <b><i>triggers</i></b>
  <li>zoom
  <li>move clip planes
  <li>place <a href="markers.html">markers</a>
  <li>measure distances
  <li>label residues
  <li>set center of rotation to atom
  <li>rotate bond
  <li>change map contour level
  <li>view map planes
  <li>crop map box
  <li>play map time series
  <li>play trajectory
  <li>next/previous docked ligand
 <li>rotate + translate <a href="commands/volume.html#tiltedslab">image slab</a>
  (single mode in VR)
</ul>
<p>
Some of the modes behave <a href="tools/mousemodes.html#vr">differently
in VR</a> as compared to in the desktop view.
</p><p>
Modes that require clicking on an atom such as selection or labeling 
require pointing at the atom with the hand-controller cone. 
This is easiest to do at close range; by default,
the clicked object must be within <b>10 cm</b> of the cone tip.
<a href="commands/device.html#clickRange">
Allowing a larger distance</a> can work, but requires accurate pointing. 
Modes that involve dragging on the desktop 
such as changing the contour level of a map are operated by 
clicking and moving the hand controller vertically. The bond-rotation 
mouse mode operates by dragging on the desktop, but in VR operates by 
rotating the hand controller. Translation and rotation are 
separate mouse modes on the desktop but a single hand-controller mode in VR.
</p><p>
The function of a hand-controller button can be reassigned
by using it to &ldquo;click&rdquo; an icon in the following tabs of the
<a href="tools/toolbar.html"><b>Toolbar</b></a>:
</p>
<ul>
<li><a href="tools/mousemodes.html"><b>Right Mouse</b></a>:&nbsp;
<img class="iconbar" src="mouse-icons.png">
<li><a href="tools/markers.html"><b>Markers</b></a>:&nbsp;
<img class="iconbar" src="marker-icons.png">
<li><a href="tools/medicalimage.html"><b>Medical Image</b></a>
(just the last section, which contains a subset of the
<a href="tools/mousemodes.html"><b>Right Mouse</b></a> icons)
</ul>
<p>
Headset display of the <a href="tools/toolbar.html"><b>Toolbar</b></a>
and other ChimeraX tool panels can be toggled with the
the Vive <b><i>menu</i></b> button or Oculus B/Y button.
</p><p>
Putting the tip of a hand controller cone on a mode-assignment icon
and clicking with the Vive
<b><i>trigger</i></b>, <b><i>trackpad</i></b>, or <b><i>grip</i></b> button
(or Oculus <b><i>trigger</i></b>, <b><i>grip</i></b>, A, X, or
<b><i>thumbstick</i></b>) reassigns that button to the function;
the icon will pop up slightly when the cone tip is in position to click it.
Hand-controller modes can also be assigned with the command 
<a href="commands/device.html#vr-button"><b>vr button</b></a>.
However, the only modes that can be controlled by tilting the Oculus 
<b><i>thumbstick</i></b> are rotate
<a href="tools/mousemodes.html" title="Mouse Modes for Right Button...">
<img class="icon" border=1 src="tools/mouse-icons/rotate.png"></a>,
zoom <a href="tools/mousemodes.html" title="Mouse Modes for Right Button...">
<img class="icon" border=1 src="tools/mouse-icons/zoom.png"></a>,
contour level
<a href="tools/mousemodes.html" title="Mouse Modes for Right Button...">
<img class="icon" border=1 src="tools/mouse-icons/contour.png"></a>,
play map series
<a href="tools/mousemodes.html" title="Mouse Modes for Right Button...">
<img class="icon" border=1 src="tools/mouse-icons/vseries.png"></a>,
and play trajectory
<a href="tools/mousemodes.html" title="Mouse Modes for Right Button...">
<img class="icon" border=1 src="tools/mouse-icons/coordset.png"></a>.
</p><p>
With N assignable buttons on each controller, up to 2N modes
can be assigned. However, leaving the <b><i>triggers</i></b> with their
default assignments
(rotation, translation, zooming) is recommended to allow manipulation
as described <a href="#default-controller">above</a>.
If a <b><i>trigger</i></b> is accidentally reassigned, using it to click
either the <b>rotate</b>
&nbsp;<img class="icon" border=1 src="tools/mouse-icons/rotate.png">&nbsp;
or <b>translate</b>
&nbsp;<img class="icon" border=1 src="tools/mouse-icons/translate.png">&nbsp;
mode icon returns it to the default behavior.
</p>

<a name="displayicons"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Other Icons: Changing the Display, Etc.</h3>
<p>
Several other <a href="tools/toolbar.html"><b>Toolbar</b></a> icons
(besides those for <a href="#mousemodes">mode assignment</a>)
may also be useful in virtual reality:
</p>
<ul>
<li><a href="tools/toolbar.html#home"><b>Home</b></a>
&ndash; open files, show recent files as tool panel, <i>etc.</i>
&nbsp;<img class="iconbar" src="home-icons.png">&nbsp;[...]
<li><a href="tools/moldisplay.html"><b>Molecule Display</b></a>:&nbsp;
<img class="iconbar" src="molecule-icons.png">
<li><a href="tools/nucdisplay.html"><b>Nucleotides</b></a>:&nbsp;
<img class="iconbar" src="nuc-icons.png">
<li><a href="tools/graphics.html"><b>Graphics</b></a>:&nbsp;
<img class="iconbar" src="graphics-icons.png">
<li><a href="tools/densitymaps.html"><b>Map</b></a>:&nbsp;
<img class="iconbar" src="density-icons.png">
<li><a href="tools/medicalimage.html"><b>Medical Image</b></a>
(an application-specific collection of icons):&nbsp;
<img class="iconbar" src="medical-icons.png">
</ul>
<p>
Headset display of the <a href="tools/toolbar.html"><b>Toolbar</b></a>
and other ChimeraX tool panels can be toggled with the
the Vive <b><i>menu</i></b> button or Oculus B/Y button.
</p><p>
An icon will pop up slightly when the cone tip is in position to click it.
The scope of action of some of the icons can be specified/limited by
<a href="selection.html">selection</a>.
</p><p>
For desired actions not already available as icons,
custom panels of buttons to execute commands can be defined with the
<a href="commands/buttonpanel.html"><b>buttonpanel</b></a> command.
</p>

<a name="interactive"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Limitations of Interactive Viewing</h3>
<p>
<font color="red" size="+1"><b>Motion sickness warning</b></font>:
If the model is stuttering or flickering in the headset
(due to insufficient rendering speed), then you should stop viewing it,
as this can easily and suddenly induce nausea that could last as long as
24 hours. Even without the stuttering, 
if you feel any motion sickness, stop using the headset.
Progression from slight nausea to needing to throw up can happen quickly.
</p>

<p>
<b>Operating systems</b>. 
We have tested ChimeraX VR on Windows 10 with an Nvidia Geforce GTX 1080 
graphics card and with an AMD Radeon RX 480 graphics card.
As of November 2018, SteamVR works well on Windows on Windows 10,
has <a href="https://www.cgl.ucsf.edu/chimera/data/mac-vr-nov2018/mac-vr.html">some support on macOS</a> High Sierra and Mojave,
and can <a href="https://www.cgl.ucsf.edu/chimera/data/linux-vr-oct2018/linuxvr.html">work on Linux</a>.
</p>

<p>
<b>Small models only</b>.
Large molecular structures (more than a few thousand atoms) render too slowly
and will cause stuttering in the headset.
Large density map surfaces also cause stuttering;
a 200<sup>3</sup> map at full resolution should work, but larger sizes 
may require <a href="tools/volumeviewer.html#step">subsampling</a> (step 2).
Current headsets render at 90 frames per second in two eyes,
so the effective rendering speed needed to avoid flickering is about 
200 frames per second. By comparison, a rendering speed of 10 frames
per second is adequate on a conventional desktop display.
</p>
<p>
<b>Simple lighting</b>.
By default ChimeraX switches to simple lighting when VR is enabled &ndash; other
<a href="commands/lighting.html">lighting modes</a> render too slowly and cause stuttering.
</p><p>
<b>Desktop rendering</b>.
The ChimeraX graphics on your normal computer display will show what the user
sees in the VR headset. Rendering to the conventional display
(generally 60 frames per second) can slow the VR rendering if ChimeraX is not
able to switch to a mode where graphics is not synchronized to vertical refresh.
To test if this is the cause of stuttering you can use the 
<a href="commands/device.html#vr"><b>vr</b></a> command option
<b>display blank</b> to prevent graphics from updating on the desktop display.
An alternative mirroring can be done by the SteamVR runtime using
SteamVR menu entry &ldquo;Mirror Display.&rdquo;
</p><p>
<b>Side View should be closed</b>.
The ChimeraX <a href="tools/sideview.html"><b>Side View</b></a> tool 
will slow headset rendering and cause stuttering, so it
should be closed during VR viewing.
</p>

<p><b>Blackout.</b> 
Modes that perform calculations taking longer than 1/90th second cause the 
graphics not to update, and the VR scene will gray out after a fraction 
of a second without graphics updates. Changing map contour level and 
running molecular dynamics are prone to this problem.
In the future these calculations will be done in parallel 
so the graphics will not be slowed down.
</p>
<p><b>Flickering labels.</b>
Atom or residue labels can cause scene flicker because labels are 
slow to render. To make this less likely,
the frequency of <a href="commands/label.html#orient">label reoriention</a>
is automatically decreased when VR is enabled.
</p>
<p><b>Selection outlines.</b>
Green <a href="selection.html">selection</a>
outlines can slow rendering and cause flicker.
</p>

<p>
<b>Clipping when models far away</b>.
If models are scaled to a very large size, parts more than 
500 meters away (in physical room dimensions) will be clipped.  
This may seem like a large distance, but as a model is scaled up
it may appear to stop increasing in size because
stereoscopic depth perception is not effective beyond about 10 meters.
As parts of the model get both larger and farther away at the same rate, 
the change in size is not evident.
To gauge model size, it can be useful to move a hand controller near 
a physical wall so that the blue mesh will provide a reference distance.
</p>

<p>
<b>Dynamic scenes may render too slowly.</b>
Dynamic (time-varying) scenes are more interesting to view than static scenes.
We have successfully displayed 3D optical microscopy time series of crawling 
cells using the command
<a href="commands/vseries.html#play"><b>vseries play</b></a>
with the <a href="commands/vseries.html#cacheFrames"><b>cacheFrames</b></a>
option so that all surface depictions are precomputed;
without that option, the VR headset rendering is too slow.
It may also help to change the scene at a slower pace, 
for example using 
<a href="commands/vseries.html#play"><b>vseries play</b></a> with the 
<a href="commands/vseries.html#maxFrameRate"><b>maxFrameRate</b></a> option.
A molecular dynamics trajectories can be played with the
<a href="commands/coordset.html"><b>coordset</b></a> command.  Use the
coordset <b>pauseFrames 9</b> option to slow the playback rate from the
90 frames per second of the headset to 10 frames per second.
</p>

<p>
<b>SteamVR room boundaries wrong.</b>
Sometimes tracing room boundaries using room-scale room setup in
SteamVR produces incorrect results (November 2018).
We have observed this when the traced space is not a simple rectangle 
because of a desk against one wall.
Tracing around the desk joins the 6 corners of the bounds in the wrong order 
&ndash; a different order than they were traced. It is unclear what is wrong
with the SteamVR room setup algorithm, but we have found that clicking 
the room tracing "Advanced Mode" checkbutton which allows you to click 
at each corner of the room reliably produces the correct SteamVR bounds.
</p>

<hr>
<address>UCSF Resource for Biocomputing, Visualization, and Informatics /
March 2023</address>
</body></html> 
